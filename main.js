(()=>{"use strict";const t=function(){function t(){}return t.DEBUG=!0,t.GAME_WIDTH=900,t.GAME_HEIGHT=900,t.FRICTION=.01,t.GRAVITY=.05,t.PHYSICS_STEP=1/60,t.PARTICLE_COUNT=2500,t}(),i=function(){function i(){this.objectList=[],this.physicsStepAccumulator=0}return i.prototype.addObject=function(t){this.objectList.push(t)},i.prototype.update=function(i){this.physicsStepAccumulator+=i,this.physicsStepAccumulator<=t.PHYSICS_STEP||(this.physicsStepAccumulator-=t.PHYSICS_STEP,this.objectList.forEach((function(t){t.applyForces(i),t.update(i)})))},i}(),o=function(){function t(t,i){void 0===i&&(i=0),this.x=t,this.y=null===i?t:i}return t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.sub=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.mul=function(i){return new t(this.x*i.x,this.y*i.y)},t.prototype.div=function(i){return new t(this.x/i,this.y/i)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.length=function(){return Math.sqrt(this.dot(this))},t.prototype.normalize=function(){var t=this.length()?this.length():1;return this.scale(1/t)},t.prototype.distance=function(t){return this.sub(t).length()},t.prototype.angle=function(){return Math.atan2(this.y,this.x)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.rotate=function(i){var o=Math.sin(i),e=Math.cos(i);return new t(this.x*e-this.y*o,this.x*o+this.y*e)},t}();var e,s=4095,n=function(t){return.5*(1-Math.cos(t*Math.PI))};function r(t,i,o){if(void 0===i&&(i=0),void 0===o&&(o=0),null==e){e=new Array(4096);for(var r=0;r<4096;r++)e[r]=Math.random()}t<0&&(t=-t),i<0&&(i=-i),o<0&&(o=-o);for(var h,a,c,p,l,u=Math.floor(t),f=Math.floor(i),y=Math.floor(o),d=t-u,v=i-f,w=o-y,g=0,E=.5,M=0;M<4;M++){var S=u+(f<<4)+(y<<8);h=n(d),a=n(v),c=e[S&s],c+=h*(e[S+1&s]-c),p=e[S+16&s],c+=a*((p+=h*(e[S+16+1&s]-p))-c),p=e[(S+=256)&s],p+=h*(e[S+1&s]-p),l=e[S+16&s],p+=a*((l+=h*(e[S+16+1&s]-l))-p),g+=(c+=n(w)*(p-c))*E,E*=.5,u<<=1,f<<=1,y<<=1,(d*=2)>=1&&(u++,d--),(v*=2)>=1&&(f++,v--),(w*=2)>=1&&(y++,w--)}return g}var h=function(){function i(t,i){this.mass=2,this.angle=0,this.velocity=new o(0),this.acceleration=new o(0),this.isStatic=!1,this.position=t,this.size=i}return i.prototype.applyForce=function(t){this.acceleration=this.acceleration.add(t.div(this.mass))},i.prototype.applyForces=function(i){if(!this.isStatic){var e=new o(0,t.GRAVITY*this.mass);this.applyForce(e);var s=this.velocity.scale(-1).normalize().scale(t.FRICTION);this.applyForce(s)}},i.prototype.update=function(i){this.isStatic||(this.velocity=this.velocity.add(this.acceleration),this.position=this.position.add(this.velocity),this.position.y+this.size.y>t.GAME_HEIGHT&&(this.position.y=t.GAME_HEIGHT-this.size.y,this.velocity.y=0),this.acceleration=new o(0))},i.prototype.draw=function(t){t.save(),t.rotate(this.angle),t.strokeStyle="#fff",t.strokeRect(this.position.x,this.position.y,this.size.x,this.size.y),t.restore()},i}();const a=h;var c,p=(c=function(t,i){return c=a.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)a.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])},c(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=t}c(t,i),t.prototype=null===i?a.create(i):(o.prototype=i.prototype,new o)}),l=function(i){function e(t,o){var e=i.call(this,t,o)||this;return e.maxSpeed=.15,e.updatePrev(),e}return p(e,i),e.prototype.follow=function(t){var i=Math.floor(this.position.x/t.gridScale)+Math.floor(this.position.y/t.gridScale)*(t.cols-1);if(null!=t.flowField[i]){var o=t.flowField[i];this.applyForce(o)}else console.log(this.position,i,t)},e.prototype.checkEdges=function(){this.position.x>t.GAME_WIDTH?(this.position.x=0,this.updatePrev()):this.position.x<0&&(this.position.x=t.GAME_WIDTH,this.updatePrev()),this.position.y>t.GAME_HEIGHT?(this.position.y=0,this.updatePrev()):this.position.y<0&&(this.position.y=t.GAME_HEIGHT,this.updatePrev())},e.prototype.updatePrev=function(){this.prevPosition=new o(this.position.x,this.position.y)},e.prototype.update=function(t){this.velocity=this.velocity.add(this.acceleration),this.velocity.length()>this.maxSpeed&&(this.velocity=this.velocity.normalize().scale(this.maxSpeed)),this.position=this.position.add(this.velocity),this.acceleration=new o(0),this.checkEdges()},e.prototype.draw=function(t){t.strokeStyle="rgba(".concat(255*Math.random(),", ").concat(100*Math.random(),", ").concat(255*Math.random(),", 0.1)"),t.beginPath(),t.moveTo(this.prevPosition.x,this.prevPosition.y),t.lineTo(this.position.x,this.position.y),t.stroke(),t.closePath(),this.updatePrev()},e}(a);const u=l;var f=function(){function i(i){this.gridScale=7,this.rows=Math.floor(t.GAME_WIDTH/this.gridScale),this.cols=Math.floor(t.GAME_HEIGHT/this.gridScale),this.particles=[],this.zOffset=0,this.increment=.03,this.engineInstance=i,this.flowField=new Array(this.rows*this.cols);for(var e=0;e<this.flowField.length;e++)this.flowField[e]=new o(0,0);for(this.particles=[],e=0;e<t.PARTICLE_COUNT;e++)this.particles[e]=new u(new o(e%t.GAME_WIDTH,t.GAME_HEIGHT/2),new o(1,1)),this.engineInstance.addObject(this.particles[e])}return i.prototype.update=function(t){for(var i=0,e=0;e<this.rows;e++){for(var s=0,n=0;n<this.cols;n++){var h=n+e*this.cols,a=r(s,i,this.zOffset)*(2*Math.PI)*4,c=new o(Math.cos(a),Math.sin(a));c.normalize(),this.flowField[h]=c,s+=this.increment}i+=this.increment,this.zOffset+=4e-5}for(var p=0;p<this.particles.length;p++)this.particles[p].follow(this),this.particles[p].update(t)},i.prototype.draw=function(t){for(var i=0;i<this.rows;i++)for(var o=0;o<this.cols;o++){var e=o+i*this.cols,s=this.flowField[e];t.beginPath(),t.moveTo(o*this.gridScale+this.gridScale,i*this.gridScale+this.gridScale),t.lineTo((o+s.x)*this.gridScale+this.gridScale,(i+s.y)*this.gridScale+this.gridScale),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.stroke()}},i}();const y=f;var d=function(){function t(){this.engineInstance=new i,this.flowField=new y(this.engineInstance)}return t.prototype.update=function(t){this.flowField.update(t)},t.prototype.draw=function(t){this.engineInstance.objectList.forEach((function(i){return i.draw(t)}))},t}();const v=d;var w=document.getElementById("game"),g=w.getContext("2d");w.width=t.GAME_WIDTH,w.height=t.GAME_HEIGHT;var E=new v,M=0;g.fillStyle="#11111f",g.fillRect(0,0,t.GAME_WIDTH,t.GAME_HEIGHT),requestAnimationFrame((function t(i){var o=i-M;M=i,E.update(o),E.draw(g),requestAnimationFrame(t)}))})();