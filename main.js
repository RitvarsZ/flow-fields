(()=>{"use strict";const t=function(){function t(){}return t.DEBUG=!0,t.GAME_WIDTH=1200,t.GAME_HEIGHT=900,t.FRICTION=.01,t.GRAVITY=.05,t.PHYSICS_STEP=1/60,t.PARTICLE_COUNT=500,t.PARTICLE_MAX_SPEED=8,t.GRID_SCALE=6,t.VECTOR_INCREMENT=.005,t.Z_OFFSET_INCREMENT=6e-7,t}(),i=function(){function i(){this.objectList=[],this.physicsStepAccumulator=0}return i.prototype.addObject=function(t){this.objectList.push(t)},i.prototype.update=function(i){this.physicsStepAccumulator+=i,this.physicsStepAccumulator<=t.PHYSICS_STEP||(this.physicsStepAccumulator-=t.PHYSICS_STEP,this.objectList.forEach((function(t){t.applyForces(i),t.update(i)})))},i}(),o=function(){function t(t,i){void 0===i&&(i=0),this.x=t,this.y=null===i?t:i}return t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.sub=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.mul=function(i){return new t(this.x*i.x,this.y*i.y)},t.prototype.div=function(i){return new t(this.x/i,this.y/i)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.length=function(){return Math.sqrt(this.dot(this))},t.prototype.normalize=function(){var t=this.length()?this.length():1;return this.scale(1/t)},t.prototype.distance=function(t){return this.sub(t).length()},t.prototype.angle=function(){return Math.atan2(this.y,this.x)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.rotate=function(i){var o=Math.sin(i),s=Math.cos(i);return new t(this.x*s-this.y*o,this.x*o+this.y*s)},t}();var s,e=4095,n=function(t){return.5*(1-Math.cos(t*Math.PI))};function r(t,i,o){if(void 0===i&&(i=0),void 0===o&&(o=0),null==s){s=new Array(4096);for(var r=0;r<4096;r++)s[r]=Math.random()}t<0&&(t=-t),i<0&&(i=-i),o<0&&(o=-o);for(var h,c,a,l,p,u=Math.floor(t),f=Math.floor(i),y=Math.floor(o),d=t-u,v=i-f,E=o-y,w=0,g=.5,I=0;I<4;I++){var S=u+(f<<4)+(y<<8);h=n(d),c=n(v),a=s[S&e],a+=h*(s[S+1&e]-a),l=s[S+16&e],a+=c*((l+=h*(s[S+16+1&e]-l))-a),l=s[(S+=256)&e],l+=h*(s[S+1&e]-l),p=s[S+16&e],l+=c*((p+=h*(s[S+16+1&e]-p))-l),w+=(a+=n(E)*(l-a))*g,g*=.5,u<<=1,f<<=1,y<<=1,(d*=2)>=1&&(u++,d--),(v*=2)>=1&&(f++,v--),(E*=2)>=1&&(y++,E--)}return w}var h=function(){function i(t,i){this.mass=2,this.angle=0,this.velocity=new o(0),this.acceleration=new o(0),this.isStatic=!1,this.position=t,this.size=i}return i.prototype.applyForce=function(t){this.acceleration=this.acceleration.add(t.div(this.mass))},i.prototype.applyForces=function(i){if(!this.isStatic){var s=new o(0,t.GRAVITY*this.mass);this.applyForce(s);var e=this.velocity.scale(-1).normalize().scale(t.FRICTION);this.applyForce(e)}},i.prototype.update=function(i){this.isStatic||(this.velocity=this.velocity.add(this.acceleration),this.position=this.position.add(this.velocity),this.position.y+this.size.y>t.GAME_HEIGHT&&(this.position.y=t.GAME_HEIGHT-this.size.y,this.velocity.y=0),this.acceleration=new o(0))},i.prototype.draw=function(t){t.save(),t.rotate(this.angle),t.strokeStyle="#fff",t.strokeRect(this.position.x,this.position.y,this.size.x,this.size.y),t.restore()},i}();const c=h;var a,l=(a=function(t,i){return a=c.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)c.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])},a(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=t}a(t,i),t.prototype=null===i?c.create(i):(o.prototype=i.prototype,new o)}),p=function(i){function s(o,s){var e=i.call(this,o,s)||this;return e.maxSpeed=t.PARTICLE_MAX_SPEED,e.color={r:175,g:0,b:0},e.updatePrev(),e}return l(s,i),s.prototype.follow=function(t){var i=Math.floor(this.position.x/t.gridScale)+Math.floor(this.position.y/t.gridScale)*(t.cols-1);if(null!=t.flowField[i]){var o=t.flowField[i];this.applyForce(o)}else console.log(this.position,i,t)},s.prototype.checkEdges=function(){this.position.x>t.GAME_WIDTH?(this.position.x=0,this.updatePrev()):this.position.x<0&&(this.position.x=t.GAME_WIDTH,this.updatePrev()),this.position.y>t.GAME_HEIGHT?(this.position.y=0,this.updatePrev()):this.position.y<0&&(this.position.y=t.GAME_HEIGHT,this.updatePrev())},s.prototype.updatePrev=function(){this.prevPosition=new o(this.position.x,this.position.y)},s.prototype.update=function(t){this.velocity=this.velocity.add(this.acceleration),this.velocity.length()>this.maxSpeed&&(this.velocity=this.velocity.normalize().scale(this.maxSpeed)),this.position=this.position.add(this.velocity),this.acceleration=new o(0),this.checkEdges()},s.prototype.draw=function(t){t.strokeStyle="rgba(".concat(this.color.r,", ").concat(this.color.g,", ").concat(this.color.b,", 0.01)"),this.color.g+=.01,this.color.b+=.05,this.color.g=this.color.g%40,this.color.b=this.color.b%120,t.beginPath(),t.moveTo(this.prevPosition.x,this.prevPosition.y),t.lineTo(this.position.x,this.position.y),t.closePath(),t.stroke(),t.shadowColor="rgba(18, 17, 31, 0.25)",t.shadowBlur=0,t.shadowOffsetX=1,t.shadowOffsetY=1,t.fill(),this.updatePrev()},s}(c);const u=p;var f=function(){function i(i){this.gridScale=t.GRID_SCALE,this.rows=Math.floor(t.GAME_WIDTH/this.gridScale),this.cols=Math.floor(t.GAME_HEIGHT/this.gridScale),this.particles=[],this.zOffset=0,this.increment=t.VECTOR_INCREMENT,this.engineInstance=i,this.flowField=new Array(this.rows*this.cols);for(var s=0;s<this.flowField.length;s++)this.flowField[s]=new o(0,0);for(this.particles=[],s=0;s<t.PARTICLE_COUNT;s++)this.particles[s]=new u(new o(Math.random()*t.GAME_WIDTH,Math.random()*t.GAME_HEIGHT),new o(1,1)),this.engineInstance.addObject(this.particles[s])}return i.prototype.update=function(i){for(var s=0,e=0;e<this.rows;e++){for(var n=0,h=0;h<this.cols;h++){var c=h+e*this.cols,a=r(n,s,this.zOffset)*(2*Math.PI)*4,l=new o(Math.cos(a),Math.sin(a));l.normalize(),this.flowField[c]=l,n+=this.increment}s+=this.increment,this.zOffset+=t.Z_OFFSET_INCREMENT}for(var p=0;p<this.particles.length;p++)this.particles[p].follow(this),this.particles[p].update(i)},i.prototype.draw=function(t){for(var i=0;i<this.rows;i++)for(var o=0;o<this.cols;o++){var s=o+i*this.cols,e=this.flowField[s];t.beginPath(),t.moveTo(o*this.gridScale+this.gridScale,i*this.gridScale+this.gridScale),t.lineTo((o+e.x)*this.gridScale+this.gridScale,(i+e.y)*this.gridScale+this.gridScale),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.stroke()}},i}();const y=f;var d=function(){function t(){this.engineInstance=new i,this.flowField=new y(this.engineInstance)}return t.prototype.update=function(t){this.flowField.update(t)},t.prototype.draw=function(t){this.engineInstance.objectList.forEach((function(i){return i.draw(t)}))},t}();const v=d;var E=document.getElementById("game"),w=E.getContext("2d");E.width=t.GAME_WIDTH,E.height=t.GAME_HEIGHT;var g=new v,I=0;w.fillStyle="#11111f",w.fillRect(0,0,t.GAME_WIDTH,t.GAME_HEIGHT),requestAnimationFrame((function t(i){var o=i-I;I=i,g.update(o),g.draw(w),requestAnimationFrame(t)}))})();